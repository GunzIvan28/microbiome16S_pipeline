## Remove primers from sequences

rule cutadapt_trim_for_DADA2:
    conda:
        "../../envs/cutadapt.yml"
    input:
        R1_raw_reads = "raw_reads/{sample}_R1.fastq.gz",
        R2_raw_reads = "raw_reads/{sample}_R2.fastq.gz"
    output:
        R1_trimmed_reads = temp("{denoiser}/1a_trimmed_primers/{sample}_trimmed_R1.fastq.gz"),
        R2_trimmed_reads = temp("{denoiser}/1a_trimmed_primers/{sample}_trimmed_R2.fastq.gz"),
    log:
        logging_folder + "{denoiser}/1a_trimmed_primers/{sample}_trimmed.txt"
    params:
        amplicon_type = config["ITS_or_16S"],
        forward_primer = config["forward_primer"],
        reverse_primer = config["reverse_primer"],
    threads:
        1
    run:
        '''
        from Bio.Seq import Seq
        from Bio.Alphabet import IUPAC

	    if params.amplicon_type == 'ITS' 
            forward_primer_compl = Seq.reverse_complement(Seq(params.forward_primer, IUPAC.ambiguous_dna)),
            reverse_primer_compl = Seq.reverse_complement(Seq(params.reverse_primer, IUPAC.ambiguous_dna))
            shell("
            cutadapt \
            --cores {threads} \
            --error-rate 0.1 \
            --times 1 \
            --overlap 3 \
            -o {output[R1_trimmed_reads]} \
            -p {output[R2_trimmed_reads]} \
            -g '{params[forward_primer]}' -a '{reverse_primer_compl}' \
            -G '{params[reverse_primer]}' -A '{forward_primer_compl}' \
            --match-read-wildcards \
            {input[R1_raw_reads]} \
            {input[R2_raw_reads]} >> {log}
            ")

        else
            shell("
            cutadapt \
            --cores {threads} \
            --error-rate 0.1 \
            --times 1 \
            --overlap 3 \
            -o {output[R1_trimmed_reads]} \
            -p {output[R2_trimmed_reads]} \
            -g '{params[forward_primer]}' \
            -G '{params[reverse_primer]}' \
            --match-read-wildcards \
            {input[R1_raw_reads]} \
            {input[R2_raw_reads]} >> {log}
            ")
        '''
