rule picrust2_qiime2 :
    conda:
        "../../envs/QIIME2-2018.11.yml"
    input:
        seqs = "{tool}/2_denoised/rep-seqs.qza",
        tree = "{tool}/2_denoised/rep-seqs.qza",
        table = "{tool}/2_denoised/otu_biom.biom",
        q-picrust = "workflow.basedir + "/data/q2-picrust2-0.0.2.zip"
    output:
        "{tool}/5_visualization/{classifier}/{db_taxonomy}/{raref_or_not}/picrust/EC_metagenome_out/pred_metagenome_unstrat.tsv"
    threads:
        4
    log:
        logging_folder + "{tool}/5_visualization/{classifier}/{db_taxonomy}/{raref_or_not}/picrust/picrust.txt"
    shell:
        '''
          unzip {q-picrust} && cd q2-picrust2-0.0.2.zip && cd q2-picrust2-0.0.2 && python setup.py install && qiime dev refresh-cache && \
          qiime picrust2 custom-tree-pipeline \
            --i-table mammal_biom.qza \
            --i-tree tutorial_placed_out/tree.qza \
            --output-dir {output} \
            --p-threads {threads} \
            --p-hsp-method mp \
            --p-max-nsti 2
        '''
